#include "aifes.h"

float  weights_data_dense_1[128] = {-0.758739f, 0.192348f, 0.453061f, -0.301272f, -0.248299f, -0.059441f, 0.184384f, -0.238698f, -0.023837f, 0.234548f, -0.282815f, 2.192671f, -0.309490f, -0.300124f, -0.394088f, -0.394340f, -0.178923f, -0.002592f, -0.487733f, -0.491378f, -0.216454f, 1.022479f, -0.357825f, -0.158436f, -0.195677f, 0.832114f, -0.108732f, -0.055598f, 0.055121f, 0.077904f, 0.080294f, 0.287286f, 1.232491f, -0.082852f, 1.552640f, 0.818751f, 0.960174f, 1.270498f, 1.068746f, -0.252451f, 0.259901f, -0.043686f, -0.448289f, 0.439650f, 0.266784f, -0.179230f, -0.285731f, 1.208486f, -0.363432f, 0.496576f, -0.353421f, 1.311451f, -0.203018f, 0.454366f, 1.338221f, 0.118250f, 0.662747f, 0.497651f, 0.339286f, -0.169772f, 0.489097f, 0.084284f, 0.434809f, 0.177331f, -1.630702f, -0.179263f, 0.319031f, -1.274371f, -0.789601f, -0.044457f, -0.613472f, 1.147876f, -0.919331f, 0.025811f, 1.687568f, 0.815716f, -0.859254f, 1.190182f, -1.099784f, -1.112992f, 1.144434f, -0.438236f, 1.228514f, -1.254727f, 0.994573f, 0.909126f, -0.751255f, -0.149296f, -0.571943f, 0.355972f, -0.634764f, 0.879966f, 0.016093f, 0.190300f, -0.386250f, 0.356244f, -1.893065f, -1.404789f, 0.571151f, -1.608294f, -1.711132f, -0.078389f, -1.291111f, 1.806343f, -1.332737f, 0.237597f, 1.513899f, 1.023737f, -0.753143f, 1.486137f, -2.094631f, -1.150513f, 1.727420f, -0.624940f, 1.200065f, -2.302408f, 1.577485f, 0.817907f, -1.447733f, -0.218712f, -0.344715f, -0.234214f, -1.366838f, 1.015428f, 0.023701f, 0.486717f, 0.089089f, -0.048379f};
float  bias_data_dense_1[32] = {-0.527797f, 1.159534f, -0.109956f, -0.669772f, -0.777756f, -1.315687f, -0.323708f, -1.409132f, -1.272024f, -1.540704f, -1.636177f, -1.627100f, -1.042913f, -1.280369f, -1.094652f, -1.063749f, -1.430785f, -1.363733f, -1.856937f, -0.311520f, -1.367774f, -1.885787f, 0.051436f, -0.356808f, -1.005704f, -0.551529f, -1.336532f, -1.175121f, -1.131964f, 0.167890f, -0.520992f, 0.471486f};
float  weights_data_dense_2[512] = {-0.867098f, -0.969223f, 1.584945f, -1.058418f, -0.588514f, 1.592813f, -0.199742f, -0.853386f, -0.251701f, 1.590344f, -0.565508f, 0.102469f, -0.717882f, -0.497783f, -0.592042f, -0.611044f, -0.631575f, -1.058415f, -0.273512f, -0.553440f, -0.429578f, -0.613960f, -1.196497f, -0.189266f, -0.218979f, -0.632930f, -0.597219f, 0.832610f, -0.834243f, 0.592803f, -0.556558f, -0.821925f, -0.578393f, -1.233244f, 0.303149f, -0.289774f, -0.489087f, 0.488232f, -0.823363f, -0.702509f, -0.833619f, 0.232597f, -0.732005f, 0.607925f, -0.579750f, -0.746035f, 1.535480f, -0.333177f,-0.363918f, 0.621616f, 1.046266f, 0.170980f, -0.174851f, -0.019286f, 0.136032f, -0.685346f, -0.267237f, 1.679410f, -0.204652f, -0.914451f, 0.454872f, -0.489852f, -1.110548f, -0.281929f, -0.422176f, 0.181542f, 1.393993f, -0.726182f, -0.645265f, 0.953106f, 0.310204f, -0.621588f, -0.521892f, 1.195630f, -0.545443f, -0.593341f, 0.075921f, -0.650864f, -0.449211f,-0.128649f, -0.462120f, 0.847040f, 1.168185f, 0.254510f, -0.227441f, 0.640354f, 0.549277f, 0.424462f, -0.806293f, 2.668225f, -0.286807f, -1.183459f, 0.824332f, 0.117572f, 0.942157f, 0.155804f, -0.793299f, 0.199531f, 0.712313f, -0.938515f, -0.509965f, 0.657791f, -0.222751f, -0.685007f, -0.904390f, -0.147394f, -0.349635f, -0.036155f, -0.284483f, 0.502616f, -0.062849f, -0.669598f, -0.823801f, 0.146808f, -1.078439f, 0.449912f, -0.181821f, -1.462301f, 0.707850f, -0.213704f, -0.658554f, -0.607905f, -0.003917f, -1.651969f, 0.050118f, 0.175898f, -0.746405f, -0.198551f, -0.385209f, 0.332578f, 0.349797f, 0.658164f, 0.291015f, 0.194348f, 0.745008f, -0.172184f, -0.328382f, 1.670133f, -0.130806f, -0.534860f, 0.434091f, 0.206073f, -1.133752f, 0.626587f, -0.352146f, 0.481901f, 0.545611f, -0.715461f, -0.897971f, 0.545559f, 0.472574f, -0.391820f, -0.474038f, 0.395009f, -0.664876f, -0.345123f, -0.259552f, -0.434935f, -0.797002f, -0.765953f, -0.432232f, -0.056246f, 0.813823f, -0.218409f, -0.336518f, -0.517412f, 1.064284f, -0.465198f, -0.744792f, 0.153664f, -0.398996f, -2.854059f, 0.126345f, 0.024993f, -1.523994f, -0.253138f, -0.491744f, 0.527644f, 1.181351f, -0.635594f, -0.793484f, -0.260146f, 1.405470f, -0.568163f, -0.399199f, -0.070897f, -0.605762f, 0.719673f, -0.141513f, 0.112928f, -0.434553f, -0.673595f, -0.467494f, 0.591564f, 0.497617f, 0.514741f, -0.349388f, 0.433813f, 0.276251f, 0.652515f, 0.731704f, 1.440965f, 0.174894f, -0.754400f, 0.477785f, 0.796172f, -0.943976f, 0.431349f, -0.278305f, -0.312745f, -1.286120f, 0.353998f, -0.260480f, -1.293224f, 0.549834f, -0.285239f, -1.098379f, -0.792253f, -0.314019f, -1.437916f, -0.466410f, 0.000498f, -0.527001f, -0.325504f,-0.443790f, 1.124304f, 0.884644f, -1.007227f, -0.453522f, 1.572439f, 0.767502f, -0.974641f, -0.886512f, 0.933832f, -0.712969f, 0.384948f, -0.434497f, 0.479190f, -0.610806f, -0.208191f, -0.581780f, -0.618411f, 1.685509f, -0.130318f, -0.851698f, 1.278872f, -0.372503f, -0.635879f, -0.823275f, 1.573532f, -0.907304f, 0.191212f, -0.399361f, -0.444932f, 0.275467f,-0.679345f, -0.733928f, 0.347971f, -0.240222f, -0.615246f, -0.752596f, -0.751118f, 1.571110f, -0.287274f, -0.284794f, 0.310766f, -0.697959f, -2.075390f, 0.199663f, -0.353823f, -1.188214f, -0.568244f, -0.570556f, 0.533026f, -0.561456f, -0.458823f, -0.583077f, 0.656980f, -0.684723f, -0.639527f, -0.279000f, -0.255655f, -0.850438f, 0.093819f, -0.169779f, -0.390887f, -0.414014f, -0.760786f, -0.115679f, -0.386451f, 0.455494f, -0.970426f, -0.285052f, 0.367496f, 1.123512f, -0.505246f, -0.427892f, 0.692463f, -0.770830f, -2.102567f, -0.261873f, 0.113191f, -1.496775f, -0.641242f, 0.060499f, -1.035430f, 1.782660f, -0.390723f, -0.646150f, 1.818578f, -1.008665f, -0.266592f, -0.503804f, 1.773501f, -0.546317f, -0.537777f, -0.732809f, -0.629473f, -0.173743f, -0.536968f, -0.895942f, 0.046085f, -0.799342f, 0.016839f, 0.219953f, -1.030668f, 0.618167f, 0.179123f, -0.335659f, -0.088021f, -0.252603f, -1.444365f, 0.304700f, 0.208934f, -1.075009f, 0.378049f, -0.498337f,0.889989f, 1.458444f, -0.451072f, -0.283804f, 0.191761f, 1.252756f, -0.891427f, -0.148252f, 0.552053f, -0.747412f, -0.514775f, -0.175337f, 0.177871f, -0.850473f, -0.763177f, -0.183461f, -1.002268f, 1.325664f, -1.025631f, -0.315831f, 1.273773f, -1.090073f, -0.372036f, -0.800126f, 1.300360f, -0.405472f, 0.748604f, -0.851295f, -0.554022f, 0.157688f, -0.305526f, -0.873448f, -0.076670f, -0.092661f, -0.179569f, -0.926820f, -0.695504f, 0.037202f, -0.810773f, -0.805347f, -0.356338f,-0.328041f, 0.222604f, -0.508634f, 0.079474f, 0.501134f, -0.352189f, -0.311234f, 0.513901f, 0.730589f, -0.189459f, -0.847486f, 0.939516f, 0.637497f, -0.502555f, -0.242984f, 0.814055f, -0.544972f, 0.408706f, -0.594592f, -0.328186f, -1.114532f, -0.789040f, -0.391768f, 0.101954f, -0.390674f, -0.413193f, -0.533709f, -0.501300f, 0.640245f, -0.804509f, -0.580852f, -0.567920f, -0.522689f, 0.146933f, -0.435204f, 0.872449f, -0.315043f, -0.269872f, -0.535321f, 0.105060f, 1.585113f, -0.156272f, -0.677092f, 1.352763f, 0.171778f, -0.175882f, -0.412273f, 1.258572f, -0.510457f, -0.467217f, -0.067850f, -0.561176f, -0.189000f, -0.503988f, -0.321012f, -0.118955f, -0.640757f, 0.570057f, -0.075260f, -1.265916f, 0.268857f, -0.547678f, -0.869898f, -0.696319f, -0.103551f, -0.850988f, -0.066870f, -0.092011f, -0.915438f, -0.693389f, -0.812556f, 0.110808f, -0.340672f, 0.716994f, -0.093451f, -0.579066f, -0.063238f, 0.349658f, -0.402871f, 0.104296f, 0.109485f, -0.365459f, 0.128645f, 0.158543f, -0.301956f, -0.520042f, -0.934439f, -0.490847f, -1.008516f, 0.059500f, -0.252668f, -1.249997f, -0.143614f, -0.430290f, -0.595840f, -0.923639f, 0.137194f, -0.203992f, -0.200952f, 0.103267f, -0.857934f, -0.429036f, -0.918953f, -0.307372f, 0.878938f, -0.438201f, -0.439412f, 0.937046f, 0.354019f, -0.439028f, -0.694451f, 0.699096f, -0.918760f, -0.290494f, -0.580283f, -0.647424f, -2.386136f, -0.338851f, -0.803859f, -0.792824f, -0.552748f, -0.253927f, -0.042523f, -0.580782f, -0.695728f, -0.149161f, -0.733593f, -0.426735f, 0.242288f, -0.006336f, -0.250221f, 0.567436f, 0.447474f, -0.406777f};
float  bias_data_dense_2[16] = {-0.600548f, -1.042646f, -0.934470f, -0.258908f, -0.600544f, -0.992616f, -1.685068f, -0.412988f, -0.494897f, -0.659942f, -0.600542f, 1.478404f, -0.527286f, -0.326467f, -0.126374f, -0.520381f};
float  weights_data_dense_3[48] = {-0.191943f, 0.473251f, 0.382954f, -2.206491f, -0.445436f, 0.152486f, 1.106482f, -1.569880f, -1.183897f, -1.061568f, 0.536764f, 0.549674f, 0.490280f, -0.345075f, -0.475109f, 1.384994f, -0.876423f, -0.552190f, -2.056720f, -0.479653f, 0.586366f, 0.161306f, 0.463131f, -0.191559f, 0.518128f, 0.441948f, -0.264265f, 1.269896f, -1.276196f, -1.078925f, 0.422459f, -0.901602f, -0.295907f, -0.988681f, 1.003679f, -1.275529f, -0.697551f, 0.345783f, 0.430517f, -2.574327f, 0.388639f, 0.557753f, -2.135000f, -0.550677f, -0.284993f, 0.828892f, 0.898661f, 0.033978f};
float  bias_data_dense_3[3] = {-1.019890f, 1.412998f, -0.542960f};

void setup() {
    Serial.begin(9600);
    Serial.setTimeout(50);
    while (!Serial) { ; }
}

void loop() {
    // Dataset Preparation
    uint16_t training_input_shape[] = {1, 4};
    uint16_t training_target_shape[] = {1, 3};

    float input_data[1 * 4] = {1.0f, 1.0f, 1.0f, 1.0f};
    float output_data[1 * 3];

    aitensor_t training_input_tensor = AITENSOR_2D_F32(training_input_shape, input_data);
    aitensor_t training_target_tensor = AITENSOR_2D_F32(training_target_shape, output_data);

    // Neural Network Design
    aimodel_t model;

    uint16_t input_layer_shape[] = {1, 4};
    ailayer_input_f32_t input_layer = AILAYER_INPUT_F32_M(4, input_layer_shape);

    ailayer_dense_f32_t dense_layer_1 = AILAYER_DENSE_F32_M(32, weights_data_dense_1, bias_data_dense_1);
    ailayer_relu_f32_t relu_layer_1 = AILAYER_RELU_F32_M();

    ailayer_dense_f32_t dense_layer_2 = AILAYER_DENSE_F32_M(16, weights_data_dense_2, bias_data_dense_2);
    ailayer_relu_f32_t relu_layer_2 = AILAYER_RELU_F32_M();

    ailayer_dense_f32_t dense_layer_3 = AILAYER_DENSE_F32_M(3, weights_data_dense_3, bias_data_dense_3);
    ailayer_softmax_f32_t softmax_layer_3 = AILAYER_SOFTMAX_F32_M();

    ailayer_t *x;

    model.input_layer = ailayer_input_f32_default(&input_layer);
    x = ailayer_dense_f32_default(&dense_layer_1, model.input_layer);
    x = ailayer_relu_f32_default(&relu_layer_1, x);
    x = ailayer_dense_f32_default(&dense_layer_2, x);
    x = ailayer_relu_f32_default(&relu_layer_2, x);
    x = ailayer_dense_f32_default(&dense_layer_3, x);
    x = ailayer_softmax_f32_default(&softmax_layer_3, x);
    model.output_layer = x;

    //Neural Network compilation
    aialgo_compile_model(&model);

    uint32_t memory_size = aialgo_sizeof_inference_memory(&model);
    void *memory_ptr = (void *) malloc(memory_size);
    if (memory_ptr == NULL) {
        return 0;
    }

    aialgo_schedule_inference_memory(&model, memory_ptr, memory_size);

    aialgo_inference_model(&model, &training_input_tensor, &training_target_tensor);

    Serial.println(output_data[0]);
    Serial.println(output_data[1]);
    Serial.println(output_data[2]);

    free(memory_ptr);

    while(1) delay(1000);
}